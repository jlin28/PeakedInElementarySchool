<!DOCTYPE html>

<!--
Joyce Lin, Evan Khosh, Sean Zheng, Zixi Qiao
PIES
SoftDev
P01 -- ArRESTed Development
TBD
-->

<html>

<head>
  <title> CHRIVIA </title>

  <!-- CUSTOM CSS -->
  <link rel="stylesheet"
    type="text/css"
    href="/static/css/style.css">

  <!-- BOOTSTRAP CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous">

  <!-- PAGE SPECIFIC CSS -->
  <style>
    /* BOARD IMAGE */
    .board {
      position: absolute;
      z-index: 0;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);

      width:clamp(200px, 1000px,1000px);
      height:auto;
    }

    #images, .row { /* TESTING PURPOSES */
      border-style: solid;
      border-width: thin;
      border-color: red;
    }

    /* GRID STYLING */
    #images, #buttons {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50.5%);
      border-color: blue; /* TESTING PURPOSES */

      width: clamp(100px, 505px,505px);
      height: clamp(100px, 500px,500px);
    }

    .row {
      height: 12.52%;
    }

    .col {
      width: clamp(10px, 50px,50px);
    }

    /* Z INDEXES */
    #images {
      z-index: 1;
    }

    #buttons {
      z-index: 2;
    }

    /* IMAGES GRID */
    .piece {
      width: 100px;
      height: auto;
      overflow: hidden;

      margin-left: -27px;
      margin-top: -25px;
    }

    /* BUTTONS GRID */
    button {
      position: absolute;
      z-index: 2;
      margin-left: -12px;
      background: none;
      border-style: none;

      width: clamp(10px, 61px,61px);
      height: 12.52%;
    }
  </style>
</head>

<body style="background-color:#D1C0A8">
  <!-- BOARD -->
  <div class="container">
    <!-- IMAGE -->
    <image src="/static/images/board.png" class="board">

    <!-- IMAGE GRID -->
    <div id="images" class="container">
      {% for ROW in board %}
        <div class="row">
          {% set index = loop.index0 %}
          {% for COL in ROW %}
            <div class="col image {{ gridlabel[loop.index0] }}{{ index }}">
              {% if COL < 0 %}
                <img class="center black piece {{ pieces[COL|abs - 1] }}"
                      src="/static/sprites/black/{{ pieces[COL|abs - 1] }}/idle.png"
                      alt="{{ pieces[COL|abs - 1] }}">
              {% elif COL > 0 %}
                <img class="center white piece {{ pieces[COL|abs - 1] }}"
                      src="/static/sprites/white/{{ pieces[COL - 1] }}/idle.png"
                      alt="{{ pieces[COL - 1]}}">
              <!-- TESTING PURPOSES -->
              {% else %}
                {{ gridlabel[loop.index0] }}{{ index }}
              <!-- -->
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% endfor %}
    </div>

    <!-- BUTTON GRID -->
    <div id="buttons" class="container">
      {% for ROW in board %}
        <div class="row">
          {% set index = loop.index0 %}
          {% for COL in ROW %}
            <div class="col {{ gridlabel[loop.index0] }}{{ index }}">
              <button onclick="select(this.parentElement.className.split(' ')[1])"> </button>
            </div>
          {% endfor %}
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- BOOTSTRAP JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"> </script>

  <!-- PAGE-SPECIFIC JS -->
  <script>
    var selected = null;
    var select = function(position) {
      if (selected != null) {
        let prev = document.querySelector("." + selected.className.split(" ")[1] + " img");
        let classnames = prev.className.split(" ");

        prev.src = '/static/sprites/' + classnames[1] + '/' + classnames[3] + '/idle.png';
      }

      let piece = document.getElementsByClassName(position)[1];
      selected = piece;
      let sprite = document.querySelector("." + piece.className.split(" ")[1] + " img");

      if (sprite != null) {
        let classnames = sprite.className.split(" ");
        sprite.src = '/static/sprites/' + classnames[1] + '/' + classnames[3] + '/select.gif';
      } else {
        selected = null;
      }
    }
  </script>
</body>

</html>
